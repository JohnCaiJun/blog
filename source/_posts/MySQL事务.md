---
title: MySQL事务
date: 2019-01-31 19:30:19
categories: 数据库
tags: MySQL
---
## ACID四个性质
并非任意的对数据库的操作序列都是数据库事务。数据库事务拥有以下四个特性，习惯上被称之为ACID特性。

1. 原子性（Atomicity）：事务作为一个整体被执行，包含在其中的对数据库的操作要么全部被执行，要么都不执行。
2. 一致性（Consistency）：事务应确保数据库的状态从一个一致状态转变为另一个一致状态。一致状态的含义是数据库中的数据应满足完整性约束。
3. 隔离性（Isolation）：多个事务并发执行时，一个事务的执行不应影响其他事务的执行。
4. 持久性（Durability）：已被提交的事务对数据库的修改应该永久保存在数据库中

## 四大隔离级别
1. 读未提交：锁在事务操作后释放
2. 读已提交（不可重复读）：锁在事务提交后释放
3. 可重复读：锁在事务提交后释放

>为了防止同事务中两次读取数据不一致，（包括不可重读和幻读），MySQL采用mvcc并发版本控制

如果事务中存在多次读取同样的数据，MySQL第一次读的时候仍然会保持选择读最新提交事务的数据，当第一次之后，之后再读时，mysql会取第一次读取的数据作为结果。这样就保证了同一个事务多次读取数据时数据的一致性。这时候，mysql把这种解决方案叫做：可重复度（Repeatable-Read)，也就是上述所写的第三个隔离性，也是mysql默认的隔离级别。

## undo log && redo log
原子性的原理：
1.undo log：原始数据的备份
    
>首先记录原始数据到undo log，然后修改数据，最后三步：将undo log写入磁盘，将数据写入磁盘，事务提交。1.如果在undo log写入磁盘之前系统崩溃，数据还没有持久化到磁盘，所以磁盘上的数据还是保持在事务开始之前的状态。2.如果在数据写入磁盘和事务提交之间系统崩溃，则可以通过undo log回滚事务。

缺陷：每个事务提交前将数据和Undo Log写入磁盘，这样会导致大量的磁盘IO，因此性能很低。将数据缓存一段时间，减少IO提高性能。但是这样就会丧失事务的持久性。因此引入了另外一
种机制来实现持久化，即Redo Log.

2.redo log：更新数据后的备份




