/**
* jQuery asPieProgress
* A jQuery plugin that animate the progress bar
* Compiled: Fri Sep 02 2016 14:07:00 GMT+0800 (CST)
* @version v0.3.4
* @link https://github.com/amazingSurge/jquery-asPieProgress
* @copyright LGPL-3.0
*/

//Mobirise initialization
var isBuilder = $('html').hasClass('is-builder');
function initCircleProgress(card) {
    $ID = $(card).attr('id')+'-svg-gradient';
    $('.pie_progress').asPieProgress({
        namespace: 'asPieProgress',
        classes: {
            element: 'pie_progress',
            number: 'pie_progress__number'
        },
        min: 0,
        max: 100,
        size: 150,
        speed: 30,
        barsize: '8',
        fillcolor: 'none',
        easing: 'ease'
    });

    $(card).find('.pie_progress').each(function() {
        $(this).asPieProgress('go', $(this).attr('data-goal') + '%');
    });

    // Opportunity gradient circles
    $(card).find('svg linearGradient').attr('id',$ID);

    $(card).find('.pie_progress svg path').each(function(){
        $(this).attr('stroke','url(#'+$ID+')');
    });
}

function setCurrentCircleProgress(card, paramName) {
    var $elem = $(card).find("." + paramName);
    $elem.asPieProgress('go', $elem.attr('data-goal') + '%');
}

if (isBuilder) {
    $(document).on('add.cards', function(event) {
        if ($('.pie_progress').length) {
            initCircleProgress(event.target);
        }
    }).on('delete.cards', function(event) {
        $(event.target).find('.pie_progress').asPieProgress('destroy');
    }).on('changeParameter.cards', function(event, paramName) {
        if (paramName.indexOf('progress') == 0) {
            if ($('.pie_progress').length) {
                setCurrentCircleProgress(event.target, paramName);
            }
            initCircleProgress(event.target);
        }
    });
} else {
    $('section').each(function(){
    	if($(this).is(':has(.pie_progress)')){
    		initCircleProgress($(this));
    	}
    });
}
